---
title: "Untitled"
output: 
  html_document: 
    keep_md: yes
---

This is homework 04 from Lucy Mei.



# Choose my own adventure.
1. Pick one of the data reshaping prompts and do it.
2. Pick a join prompt and do it.

# General data reshaping and relationship to aggregation.

```{r}
library(gapminder)
library(tidyverse)
library(tidyr)
library(dplyr)
```

Prompts: 
## Activity #1
Make my own cheatsheet similar to Tyler Rinker's minimal guide to tidyr.
### First, get my data.
```{r}
country_lifeExp <- gapminder %>%
  select(country, lifeExp, pop) %>%
  group_by(country) %>%
  summarize(mlifeExp = mean(lifeExp), mpop=mean(pop))
  

dat <- data.frame(country_lifeExp)
dat
```

### Gather in Action
```{r}
dat %>% 
  gather (factor, number, -c(country))
```
In this case, we know that number is referred to lifeExp.

### Spread it Back Out
```{r}
dat %>% 
  gather(factor, number, -c(country)) %>%
  spread(factor, number)
```

```{r}
dat %>% gather(factor, number, mlifeExp)
```
In this case, only lifeExp is taken out to reshape.

```{r}
dat %>% 
  gather(factor, number, mlifeExp, mpop)
```

```{r}
dat %>% 
  gather(factor, number, -c(country)) %>%
  spread(country, number)
```
This way, the data can create columns according to each country.

## Activity #2 - Make a tibble with one row per year and columns for life expectancy for two or more countries
```{r}
coun_life<- gapminder %>%
  filter(country %in% c("China", "India")) %>%
  select(year, country,lifeExp) 
  
dat2 <- data.frame(coun_life)
dat2
```

This is a table of life expectancy of China and India of each year.
```{r}
dat21 <- dat2 %>% 
  spread (country, lifeExp)
knitr::kable(dat21, align = 'c', format = 'markdown', digits = 2, col.names= c("Year", "China", "India"))
```
It took me a while to figure this out. Year can stay the same, and I will type in what columns I want, then put in the corresponding value.

So, let's make a scatterplot. 
```{r}
ggplot(dat21, aes(year, China)) +
  geom_point(aes(year, China), color = "red") +
  geom_point(aes(year, India), color = "orange") +
  labs(x="Year", y="Life Expectancy", title ="Change of Life Expectancy of China and India Over Time")
```

## Activity #3 - Compute some measure of life expectancy for all possible combinations of continent and year. Reshape that to have one row per year and one variable for each continent. Or one row per continent and one variable per year.

```{r}
dat3 <- gapminder %>%
  select(continent, lifeExp, year) %>%
  group_by(continent, year) %>%
  mutate(meanle = mean(lifeExp))

dat31 <- data.frame(
  dat3 %>%
    select(year, continent, meanle))

dat31
```
```{r}
dat32 <- dat31 %>%
  spread(continent, meanle)
```

## Activity #4 - In Window functions, we formed a tibble with 24 rows: 2 per year, giving the country with both the lowest and highest life expectancy (in Asia). Take that table and reshape it so you have one row per year or per year * continent combination.

First, I copied the table.
```{r}
dat4 <- gapminder %>%
  select(year, continent, country, lifeExp) %>%
  group_by(continent, year) %>%
  filter(min_rank(desc(lifeExp)) < 2 | min_rank(lifeExp) < 2) %>% 
  arrange(year) 
dat4
```
I am not sure if I need to include the country or not. So I made one that is with the country.
```{r}
dat41 <- dat4 %>%
  spread(continent, lifeExp)

knitr::kable(dat41, align = 'c', format = 'markdown', digits = 2)

```

## Activity #5 - Make up a similar set of exercises for myself.
Load the packages.
```{r}
library(reshape2)
library(dplyr)
```

### Group
Create a set of data for the exercise. This table summarize the country and year where the population is lower than the global mean.
```{r}
dat5 <- gapminder %>%
  filter(pop < 2.960e+07) %>%
  select(continent, country, pop, year)

knitr::kable(dat5,align = 'c', format = 'markdown', digits = 2, col.names=c("Continent", "Country", "Population", "Year"))

dat51 <- dat5 %>%
  group_by(continent, country) %>%
  summarize(Occurrence = n(), Sumofpop=sum(pop))
knitr::kable(dat51, align = 'c', format = 'markdown', digits = 2, col.names=c("Continent", "Country", "Number of years with low population", "Sum of population"))
```

### Split
Turn dat51 into dat52.
```{r}
dat52 <- dcast(dat51, continent~country, value.var="Occurrence")
knitr::kable(dat52, align = 'c', format = 'markdown', digits = 2)
```

Now, try to use table.
```{r}
dat53 <-with(dat5, table(continent, country))
knitr::kable(dat53, align = 'c', format = 'markdown', digits = 2)
```

Use dcast to obtain a data.frame.
```{r}
dat54 <-dcast(dat5, continent~country, value.var="pop", fun.aggregate = length)
knitr::kable(dat54, align = 'c', format = 'markdown', digits = 2)
```


### Stack
Turn dat52 into dat55.
```{r}
dat55 <- melt(dat52, id="continent") %>%
  arrange(continent)
knitr::kable(dat55, align = 'c', format = 'markdown', digits = 2, col.names = c("Continent", "Country", "Number of years with low population"))
```


### Join
Create data frames.
```{r}
country <- c("Canada", "Finland", "India")
area <- c(9985000, 338, 3287000)
New_country <- data.frame(country, area)

Old_country <- gapminder %>%
  filter(country %in% c("Canada", "Finland", "India"), year>= 1987, year <=2001) %>%
  select(country, lifeExp)

New_country
Old_country


New_country1 <- data.frame(New_country)
Old_country1 <- data.frame(Old_country)
```
Join by country.
```{r}
join_country <- left_join(Old_country1, New_country1)
knitr::kable(join_country, align = 'c', format = 'markdown', digits = 2)
```

If use merge
```{r}
merge_country <- merge(Old_country1, New_country1)
knitr::kable(merge_country, align = 'c', format = 'markdown', digits = 2)
```

### Subset
To filter out the data I want.
```{r}
subset_new_country <- filter(New_country1, country=="Finland")
knitr::kable(subset_new_country, align = 'c', format = 'markdown', digits = 2)
```

### Transpose
```{r}
New_country1_transpose <- data.frame(t(New_country1))
knitr::kable(New_country1_transpose, align = 'c', format = 'markdown', digits = 2)
```
### Sort
```{r}
country_arrange <- arrange(join_country, country, lifeExp, area)
knitr::kable(country_arrange, align = 'c', format = 'markdown', digits = 2)
```


# Join, merge, look up

## Activity #1 - Create a second data frame, complementary to Gapminder. Join this with Gapminder using a dplyr join function and make some observations about the process and result. Explore the different types of joins.

First, I am going to create a second data frame.
```{r}
country <- c("Canada", "China", "Japan", "United Kingdom", "Germany", "Finland", "Greece","Hungary", "Belgium")
area <- c(9985000, 9597000, 377962, 242495, 357376, 338424,131957, 93030, 30528 )
language <- c("English", "Chinese", "Japanese", "English", "German", "Finnish", "Greek", "Hungarian", "German")

area_language <- data.frame(country, area, language)
knitr::kable(area_language, align = 'c', format = 'markdown', digits = 2)
```

To avoid overwhelming data, I am going to filter some countries from gapminder.
```{r}
gapminder2 <- gapminder %>%
  filter(country %in% c("Canada", "China", "Japan", "United Kingdom", "Germany", "Finland", "Greece","Hungary", "Belgium", "America", "India", "Korea", "France", "Italy"))

knitr::kable(gapminder2, align = 'c', format = 'markdown', digits = 2)
```


Join area_language to gapminder2.
Left_join is joined by country, and two more columns are produced, area and language. For countries not in area_language dataset, NA is displaced in this two columns.
```{r}
left_join(gapminder2, area_language) %>%
  knitr::kable(align = 'c', format = 'markdown', digits = 2)
```

```{r}
semi_join(gapminder2, area_language) %>%
  knitr::kable(align = 'c', format = 'markdown', digits = 2)

semi_join(gapminder2, area_language) %>%
  filter(country=="America")
```
semi_join only joins the common data and exludes countries that are not in area_language dataset.

I want to look at countries that speaks English.
```{r}

```










