---
title: "Untitled"
output: 
  html_document: 
    keep_md: yes
---

This is homework 05 from Lucy Mei.

# Homework05: Factor and figure management; Repo hygiene
## Goal
1. Reorder a factor in a principled way based on the data and demonstrate the effect in arranged data and in figures.

2. Improve a figure (or make one from scratch), using new knowledge, e.g., control the color scheme, use factor levels, smoother mechanics.

3. Implement visualization design principles.

4. Write some data to file and load it back into R. e.g. save a plot to file and include it in a R markdown report via ![Alt text](/path/to/img.png).

5. Organize my github, to celebrate the completion of STAT 545.

## For this homework I am going to use gapminder
```{r}
library(gapminder)
library(tidyverse)
```

## Factor management
Step goals: 
- Define factor variables;
- Drop factor / levels;
- Reorder levels based on knowledge from data

### Drop Oceania.
First, I am going to check the number of rows in gapminder.
```{r}
nrow(gapminder)
```

1. Filter the Gapminder data to remove observations associated with the continent of Oceania and check how many rows are left.
```{r}
gapfiltered <- gapminder %>%
  filter(continent %in% c("Asia", "Americas", "Europe", "Africa"))
nrow(gapfiltered)
```

2. Additionally, remove unused factor levels. 
First, let's look at the levels of the gapfiltered (filtered out Oceania).
```{r}
nlevels(gapfiltered$continent)
```
Although I filtered Oceania in the first step, when we look at the level of continent, there are still 5 levels.

Now, I am going to remove the level using the base function droplevels().
```{r}
gapfiltered_dropped <- gapfiltered %>%
  droplevels()
nlevels(gapfiltered_dropped$continent)
nrow(gapfiltered_dropped)
```
After dropping the level, there are only 4 levels in continent. The number of rows is the same before and after dropping the unused level.


### Reorder the levels of country or continent.
In this section, I am interested in looking at the maximum GDP per capita of Europe countries in 1952 amd 2007.
First, I will need to filter out the data I want.
```{r}
gdpPercap_1952 <- gapminder %>%
  filter(continent == "Europe", year == 1952)
nlevels(gdpPercap_1952$country)

gdpPercap_2007 <- gapminder %>%
  filter(continent == "Europe", year ==2007)
nlevels(gdpPercap_2007$country)
```
Since I only filtered the data, when I look at the level of countries, it still shows total of 142 levels.

So I am going to drop the unused levels now.
```{r}
gdpPercap_1952 <- gdpPercap_1952 %>%
  droplevels()
nlevels(gdpPercap_1952$country)

gdpPercap_2007 <- gdpPercap_2007 %>%
  droplevels()
nlevels(gdpPercap_2007$country)
```
Good, so both data I want only have 30 levels.
Let's make a plot first.
```{r}
gdpPercap_1952 %>%
  ggplot(aes(gdpPercap, country)) + 
  geom_point(aes(gdpPercap, country)) +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 1952")

gdpPercap_2007 %>%
  ggplot(aes(gdpPercap, country)) + 
  geom_point(aes(gdpPercap, country)) +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 2007")
```
The plots do not give useful information.

Now, I am going to reorder the levels according to maximum GDP per capita.
```{r}
gdpPercap_1952 %>%
  ggplot(aes(gdpPercap, forcats::fct_reorder(country, gdpPercap))) + 
  geom_point() +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 1952")

gdpPercap_2007 %>%
  ggplot(aes(gdpPercap, forcats::fct_reorder(country, gdpPercap))) + 
  geom_point() +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 2007")
```
The plots are now arranged according to GDP per capita. From these two plots it is easy to tell that Norway and Switzerland had high GDP per capita in both 1952 and 2007. GDP per capita in Europe increased in general from 1952 to 2007.

*Need to fix this*
If I look at the continent.
```{r}
gdpPercap_continent1952 <- gapminder %>%
  filter(year == 1952)
gdpPercap_continent1952 <- gdpPercap_continent1952 %>%
  droplevels()

gdpPercap_continent2007 <- gapminder %>%
  filter(year == 2007)
gdpPercap_continent2007 <- gdpPercap_continent2007 %>%
  droplevels()
```
And I reorder the level according to maximum GDP per capita of the continent.
```{r}
gdpPercap_continent1952 %>%
  ggplot(aes(forcats::fct_reorder(continent, gdpPercap, max),gdpPercap)) +
  geom_point() +
  labs(x="Continent", y="GDP per capita", title = "GDP per capita of continents in 1952")

gdpPercap_continent2007 %>%
  ggplot(aes(forcats::fct_reorder(continent, gdpPercap, max), gdpPercap)) + 
  geom_point() +
  labs(x="Continent", y="GDP per capita", title = "GDP per capita of continents in 2007")
```


### Common part
Characterize the (derived) data before and after your factor re-leveling.
- Explore the effects of arrange(). Does merely arranging the data have any effect on a figure?

If I arrange gapminder data of Europe in 1950 according to GDP per capita and then plot. The plot is not in the arranged order. However, the table generated is arranged according to ascending gdpPercap.
```{r}
gdpPercap_1952 %>%
  arrange(gdpPercap) %>%
  ggplot(aes(gdpPercap,country)) +
  geom_point() +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 1952")

gdpPercap_1952 %>%
  arrange(gdpPercap) %>%
  knitr::kable(align = 'c', format = 'markdown', digits = 2)
```

*Need to fix this*
- Explore the effects of reordering a factor and factor reordering coupled with arrange(). Especially, what effect does this have on a figure?
If I reorder the level according to GDP per capita and plot the same thing as the previous plot.
```{r}
gdpPercap_1952 %>%
  ggplot(aes(gdpPercap, forcats::fct_reorder(country, gdpPercap))) + 
  geom_point() +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 1952")
```
As shown before, it gives a new ordered plot.

If I use a combination of reordering and arrange(). For example, what if I arrange the data according to life expectancy first and then I plot it using reordering according to gdpPercap. It shows that arrange() has not effect on the plot.
```{r}
gdpPercap_1952 %>%
  arrange(lifeExp) %>%
  ggplot(aes(gdpPercap, forcats::fct_reorder(country, gdpPercap))) + 
  geom_point() +
  labs(x="GDP per capita", y="Country", title = "GDP per capita of European countries in 1952")
```

## File I/O
Experiment with one or more of write_csv()/read_csv() (and/or TSV friends), saveRDS()/readRDS(), dput()/dget(). 
Create something new, probably by filtering or grouped-summarization of Gapminder.
Incorporate factor levels.

First, I load gapminder data and turn country and continent to factors for later manipulation.
```{r}
(gap_tsv <- system.file("gapminder.tsv", package = "gapminder"))
gapminder <- read_tsv(gap_tsv)
str(gapminder, give.attr=FALSE)
gapminderfactor <- gapminder %>%
  mutate(country = factor(country),
         continent = factor(continent))
str(gapminderfactor)
```

*How to reorder and then keep the reorder in the data*
I am going to create a new dataset of gapminder data of Asia from 2001 to 2007 and reorder the level of country according to population.
```{r}
gap_asia2000 <- gapminderfactor %>%
  filter(continent=="Asia", year > 2000) %>%
  droplevels()
forcats::fct_reorder(gap_asia2000$country, gap_asia2000$pop, max)
levels(gap_asia2000$country)
data.frame(gap_asia2000)

```

Now, I am going to write the data.
```{r}
write_csv(gap_asia2000, "gap_asia2000.csv")
```

And read it again.
```{r}
read_csv("gap_asia2000.csv")
levels(gap_asia2000$country)
```

## Visualization design
Remake at least one figure or create a new one, in light of something I learned in the recent class meetings about visualization design and color. 
Juxtapose the first attempt and what I obtained after some time spent working on it.
Reflect on the differences. 

## Writing figures to file
Use ggsave() to explicitly save a plot to file.
Then use ![Alt text](/path/to/img.png) to load and embed it in my report. 

